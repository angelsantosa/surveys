function participant_get_all(){$("#member_bulk_load_resume").html("");$("#members_list > .messages-item").removeClass("active starred");$("#members_list > .messages-item[id=0]").toggleClass("active starred");$("#select_all").prop("checked",false);$("#add_member_participant").hide();$("#bulk_load_button").hide();$.ajax({url:"/api/participants/",type:"GET",success:function(b){var c=$("#participant_menu").html();$(".message-content").empty();$(".message-header #config-menu-participant").html(c);$(".message-content").append("<div class='panel-body messages' id='0'><div class='messages-list'></div></div>");for(var a=0;a<b.length;a++){$(".panel-body[id=0] > .messages-list").append("<li class='messages-item-from'><input type='checkbox' id='p"+b[a].id+"' class='checkbox_participant' value='0'></input>&nbsp;<label for='p"+b[a].id+"' style='cursor:pointer;'>"+b[a].email+"</label>&nbsp;<a role='menuitem' tabindex='-1' href='#participant_modal_detail' data-toggle='modal' onclick='participant_modal_detail("+b[a].id+")'><i class='fa fa-eye'></i></a></li>")}checkboxHandler();$("#participant_count_selected").html("&nbsp;(0)");$(".messages-list > li > .cbx-container").click(function(){var d=0;$(".checkbox_participant[value=1]").each(function(f,e){d+=1});$("#participant_count_selected").html("&nbsp;("+d+")")});$("#participant_menuitem_delete").hide();$("#participant_menuitem_move").hide()},error:function(b,c,a){console.log(b.status+": "+b.responseText)}})}function participant_load(a,c){var b=$("#participant_menu").html();$(".message-content").empty();$(".message-header #config-menu-participant").html(b);$(".message-content").append("<div class='panel-body messages' id='"+a+"'><div class='messages-list'></div></div>");$("#members_list > .messages-item").removeClass("active starred");$("#members_list > .messages-item[id="+a+"]").toggleClass("active starred");$("#select_all").prop("checked",false);$("#add_member_participant").show();$("#bulk_load_button").attr("onclick","member_modal_bulk_load_config("+a+")");$("#bulk_load_button").show();$("#add_participant").attr("value",a);$("#delete_participants_selected").attr("onclick","participant_selected_delete("+a+")");$("#participant_menuitem_copy").attr("onclick","participant_selected_validate_copy("+a+")");$("#participant_menuitem_move").attr("onclick","participant_selected_validate_move("+a+")");$("#participant_modal_move_submit").attr("onclick","participant_selected_move("+a+")");$("#participant_modal_copy_submit").attr("onclick","participant_selected_copy("+a+")");$.ajax({url:"/api/members/"+a+"/participants/",type:"GET",success:function(e){for(var d=0;d<e.length;d++){if(e[d].email==c){$(".panel-body[id="+a+"] > .messages-list").prepend("<li class='messages-item-from'><input type='checkbox' id='p"+e[d].id+"' class='checkbox_participant' value='0'></input>&nbsp;<label for='p"+e[d].id+"' style='cursor:pointer; color:green;'>"+e[d].email+"</label>&nbsp;<a role='menuitem' tabindex='-1' href='#participant_modal_detail' data-toggle='modal' onclick='participant_modal_detail("+e[d].id+")'><i class='fa fa-eye'></i></a></li>")}else{$(".panel-body[id="+a+"] > .messages-list").append("<li class='messages-item-from'><input type='checkbox' id='p"+e[d].id+"' class='checkbox_participant' value='0'></input>&nbsp;<label for='p"+e[d].id+"' style='cursor:pointer;'>"+e[d].email+"</label>&nbsp;<a role='menuitem' tabindex='-1' href='#participant_modal_detail' data-toggle='modal' onclick='participant_modal_detail("+e[d].id+")'><i class='fa fa-eye'></i></a></li>")}}if(e.length==0){participant_show_empty_message()}checkboxHandler();$("#participant_count_selected").html("&nbsp;(0)");$(".messages-list > li > .cbx-container").click(function(){var f=0;$(".checkbox_participant[value=1]").each(function(h,g){f+=1});$("#participant_count_selected").html("&nbsp;("+f+")")});$("#search_participant").val("")},error:function(e,f,d){console.log(e.status+": "+e.responseText)}})}function participant_modal_detail(a){$.ajax({url:"/api/participants/"+a,type:"GET",success:function(b){$("#participant_modal_detail_mailto").attr("href","mailto:"+b.email);$("#participant_modal_detail_confirm_delete").attr("onclick","participant_detail_delete("+a+")");$("#participant_modal_detail_field_email").html(b.email);$("#participant_modal_detail_field_email").on("hidden",function(d,c){$("#participant_modal_detail_edit").show()});$("#participant_modal_detail_field_email").on("shown",function(d,c){$("#participant_modal_detail_edit").hide()});$("#participant_modal_detail_field_email").editable({url:"/api/participants/"+a,ajaxOptions:{dataType:"json",type:"PUT"},params:function(d){var c={};c.email=d.value;return c},send:"always",name:"participant_modal_detail_field_email",type:"text",tpl:"<input type='text' style='width:250px;'>",validate:function(d){var c=/^([a-zA-Z0-9_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/;if($.trim(d)==""){return gettext("participant-modal-detail-edit-required")}if(c.test($.trim(d))==false){return gettext("participant-modal-detail-edit-valid")}},success:function(d,e){var g=$("#participant_modal_detail_form");var f=$(".messageHandler",g);var c=$(".errorHandler",g);if(d&&d.email){$(this).removeClass("editable-unsaved");f.html("<i class='fa fa-info-circle fa-lg'></i>"+gettext("participant-modal-detail-complete"));c.hide();f.show()}else{if(d&&d.errors){config.error.call(this,d.errors)}}},error:function(g){var f=$("#participant_modal_detail_form");var e=$(".messageHandler",f);var c=$(".errorHandler",f);if(g&&g.responseText){e.hide();c.show();var d=JSON.parse(g.responseText);c.html("<i class='fa fa-exclamation-circle fa-lg'></i> "+gettext(d.name));console.log(g.status+": "+g.responseText)}}});$(document).on("click","#participant_modal_detail_edit",function(c){c.stopPropagation();$("#participant_modal_detail_field_email").editable("show")})},error:function(c,d,b){console.log(c.status+": "+c.responseText)}});participant_get_member_list(a)}function participant_get_member_list(a){$("#participant_modal_detail_remove").empty();var b=0;$.ajax({url:"/api/participants/"+a+"/members/",type:"GET",success:function(d){for(var c=0;c<d.length;c++){b+=1;$("#participant_modal_detail_remove").append("<tr id='mem"+d[c].id+"' ><td class='center'>"+b+"</td><td class='hidden-xs'>"+d[c].name+"</td><td class='center'><div class='visible-md visible-lg hidden-sm hidden-xs'><a href='#' class='btn btn-xs btn-red tooltips' data-placement='top' data-original-title='Remove' onclick='participant_modal_detail_remove_from_member_grid_action("+d[c].id+", "+a+")'><i class='fa fa-times fa fa-white'></i></a></div></td></tr>")}if(b==1){$("#participant_modal_detail_confirm_delete_hidden").val("true")}else{$("#participant_modal_detail_confirm_delete_hidden").val("false")}},error:function(d,e,c){console.log(d.status+": "+d.responseText)}})}function participant_modal_detail_remove_from_member(b,a){$.ajax({url:"/api/members/"+b+"/participants/"+a,type:"DELETE",success:function(c){},error:function(d,e,c){console.log(d.status+": "+d.responseText)}})}function participant_delete(a){$.ajax({url:"/api/participants/"+a+"/members/",type:"DELETE",success:function(b){},error:function(c,d,b){console.log(c.status+": "+c.responseText)}})}function participant_add(b){var d=$("#add_email_form");var f=$("#add_email_participant",d);var a=$(".errorHandler",d);var c=$(".messageHandler",d);email_participant=f.val();var e=0;$(".checkbox_participant").each(function(h,g){email=$("label[for='p"+g.id.substring(1)+"']").html();if(email==email_participant){e=1}});if(e==1){c.hide();a.html("<ul class='fa-ul'><li><i class='fa fa-exclamation-circle fa-li fa-lg'></i>&nbsp;"+interpolate(gettext("add-email-participant-error-email-duplicated"),[email_participant])+"</li></ul>");a.show();f.select()}else{a.hide();c.show();c.html("<ul class='fa-ul'><li><i class='fa fa-spinner fa-li fa-spin'></i>&nbsp;"+gettext("participant-add-spinner")+"</li></ul>");$.ajax({url:"/api/members/"+b+"/participants/",type:"POST",data:{email:email_participant},success:function(g){c.html("<ul class='fa-ul'><li><i class='fa fa-info-circle fa-li fa-lg'></i>"+gettext("participant-add-complete")+"</li></ul>");member_load(b,email_participant);$("#add_email_participant").val("");toastr.info(gettext("add-email-participant"))},error:function(i,j,h){c.hide();a.show();var g=JSON.parse(i.responseText);a.html("<div class='col-sm-7 text-danger' style='text-align:left'><i class='fa fa-exclamation-circle fa-lg'></i> "+gettext(g.name)+"</div>");console.log(i.status+": "+i.responseText);f.select()}})}}function participant_selected_delete(a){var b="";$(".checkbox_participant[value=1]").each(function(d,c){b=b+c.id.substring(1)+","});b=b.substring(0,b.length-1);if($("[name='options']:checked").val()=="option1"){participant_list_delete_from_member_list(a,b)}else{if($("[name='options']:checked").val()=="option2"){participant_list_delete_from_member_list("-1",b)}}$("#close_delete_modal_participant").click();$("#participant_modal_delete_close").click();member_load(a)}function participant_selected_copy(a){var c="";var b="";$(".checkbox_participant[value=1]").each(function(e,d){b=b+d.id.substring(1)+","});$(".checkbox_member:checked").each(function(d,e){c=c+e.value+","});b=b.substring(0,b.length-1);c=c.substring(0,c.length-1);participant_list_add_to_member(c,b);$("#participant_modal_copy_close").click();member_load(a)}function participant_add_show(){var c=$("#add_email_form");var a=$(".errorHandler",c);var b=$(".messageHandler",c);$("#msg_area_participant").removeClass();$("#msg_area_participant").toggleClass("alert alert-success");$("#add_member_participant").removeClass();$("#add_member_participant").toggleClass("btn btn-light-grey");$("#add_member_participant").removeAttr("onclick",null);c.find("#tools_add_participant").show("slow");b.show("slow");b.html("<ul class='fa-ul'><li><i class='fa fa-info-circle fa-li fa-lg'></i>"+gettext("participant-add-instruccions")+"</li></ul>");$("#message_empty_participant").removeClass();$("#message_empty_participant").toggleClass("btn btn-light-grey");$("#message_empty_participant").removeAttr("onclick",null);$("#add_email_participant").focus()}function participant_add_cancel(){var c=$("#add_email_form");var a=$(".errorHandler",c);var b=$(".messageHandler",c);$("#add_member_participant").removeClass();$("#add_member_participant").toggleClass("btn btn-primary");$("#add_member_participant").attr("onclick","participant_add_show()");c.find("#tools_add_participant").hide("slow");b.hide("slow");a.hide("slow");c.find(".help-block").remove();c.find(".form-group").removeClass("has-error");$("#add_email_participant").val("");$("#message_empty_participant").attr("onclick","participant_add_show()");$("#message_empty_participant").removeClass();$("#message_empty_participant").toggleClass("btn btn-primary");a.html("<ul class='fa-ul'><li><i class='fa fa-exclamation-circle fa-li fa-lg'></i>&nbsp;"+gettext("participants-add-email-error")+"</li></ul>")}function participant_selected_send_email(a){if($(".checkbox_participant:not([value=0])").length===0){a.preventDefault();$("#participant_menuitem_send_email").attr("href","");toastr.info("participant-checkbox-send-email-error");return}var b="";$(".checkbox_participant[value=1]").each(function(d,c){email=$("label[for='p"+c.id.substring(1)+"']").html();b=b+email+", "});$("#participant_menuitem_send_email").attr("href","mailto:"+b)}function participant_selected_move(a){var b="";var c="";$(".checkbox_participant[value=1]").each(function(e,d){c=c+d.id.substring(1)+","});b=$("#list_members_to_move option:selected").val();c=c.substring(0,c.length-1);participant_list_add_to_member(b,c);participant_list_delete_from_member_list(a,c);$("#participant_modal_move_close").click();if(SHOW_LIST_ON_MOVE==true){member_load(b)}else{member_load(a)}}function participant_detail_delete(a){participant_delete(a);$("#close_modal").click();$("#participant_modal_detail_close").click();member_load(0);participant_get_member_list(a)}function participant_modal_detail_remove_from_member_grid_action(b,a){$("#delete_rapid_confirm").attr("onclick","participant_modal_detail_remove_from_member_confirm("+b+", "+a+")");if($("#participant_modal_detail_confirm_delete_hidden").val()=="true"){$("#participant_modal_detail_rapid").click()}else{$("#participant_modal_detail_remove").find("#mem"+b).hide("slow");participant_modal_detail_remove_from_member(b,a);member_load(b)}}function participant_modal_detail_remove_from_member_confirm(b,a){participant_modal_detail_remove_from_member(b,a);$("#close_modal_rapid").click();$("#participant_modal_detail_close").click();member_load(b);participant_get_member_list(a)}function participant_selected_validate_delete(){$("#participant_modal_delete").on("show.bs.modal",function(){if($(".checkbox_participant:not([value=0])").length===0){$("#participant_modal_delete").modal("toggle")}});if($(".checkbox_participant:not([value=0])").length===0){toastr.warning(gettext("participant-checkbox-delete-error"))}$("input[value = 'option1']").iCheck("check")}function participant_selected_validate_copy(a){$("#participant_modal_copy").on("show.bs.modal",function(){if($(".checkbox_participant:not([value=0])").length===0){$("#participant_modal_copy").modal("toggle")}else{if($("#members_list > li").length===1){$("#participant_modal_copy").modal("toggle")}}});if($(".checkbox_participant:not([value=0])").length===0){toastr.warning(gettext("participant-checkbox-delete-error"))}else{if($("#members_list > li").length===1){toastr.warning(gettext("participant-copy-member-error"))}else{member_load_elements(a)}}}function participant_selected_validate_move(a){$("#participant_modal_move").on("show.bs.modal",function(){if($(".checkbox_participant:not([value=0])").length===0){$("#participant_modal_move").modal("toggle")}else{if($("#members_list > li").length===1){$("#participant_modal_move").modal("toggle")}}});if($(".checkbox_participant:not([value=0])").length===0){toastr.warning(gettext("participant-checkbox-delete-error"))}else{if($("#members_list > li").length===1){toastr.warning(gettext("participant-copy-member-error"))}else{member_load_elements(a)}}}function participant_list_add_to_member(b,a){$.ajax({url:"/api/members/participants/",type:"POST",async:false,data:{members:b,participants:a},success:function(c){},error:function(d,e,c){console.log(d.status+": "+d.responseText)}})}function participant_list_delete_from_member_list(b,a){$.ajax({url:"/api/members/participants/",type:"DELETE",async:false,data:{members:b,participants:a},success:function(c){},error:function(d,e,c){console.log(d.status+": "+d.responseText)}})}function participant_show_empty_message(){$(".message-content").find(".messages-list").html(gettext("participant-show-empty-message")+"&nbsp;<a id='message_empty_participant' class='btn btn-primary' onclick='participant_add_show()'><i class='fa fa-plus'></i></a> "+gettext("participant-show-empty-message2"));if($("#add_member_participant").attr("class")=="btn btn-light-grey"){$("#message_empty_participant").removeClass();$("#message_empty_participant").toggleClass("btn btn-light-grey");$("#message_empty_participant").removeAttr("onclick",null)}};