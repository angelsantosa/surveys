var bulk_load_callbacks=$.Callbacks();function member_load(a,b){$("#members_list").empty();$.ajax({url:"/api/members/",type:"GET",success:function(d){var f=$("#config-menu").html();var e=0;for(var c=0;c<d.length;c++){$("#members_list").append("<li id='"+d[c].id+"' class='messages-item' >"+f+"<div class='inline space' onclick='participant_load("+d[c].id+")'><a class='messages-item-from'>"+d[c].name+"&nbsp;("+d[c].email_count+")</a></div></li>");$("#member_menuitem_delete").attr("id","member_menuitem_delete_"+d[c].id);$("#member_menuitem_delete_"+d[c].id).attr("onclick",'member_modal_delete_config("'+d[c].name+'",'+d[c].id+")");$("#member_menuitem_rename").attr("id","member_menuitem_rename_"+d[c].id);$("#member_menuitem_rename_"+d[c].id).attr("onclick",'member_modal_rename_config("'+d[c].name+'",'+d[c].id+")");$("#member_menuitem_duplicate").attr("id","member_menuitem_duplicate_"+d[c].id);$("#member_menuitem_duplicate_"+d[c].id).attr("onclick",'member_modal_duplicate_config("'+d[c].name+'",'+d[c].id+")");$("#member_menuitem_bulk_load").attr("id","member_menuitem_bulk_load-"+d[c].id);$("#member_menuitem_bulk_load-"+d[c].id).attr("onclick","member_modal_bulk_load_config("+d[c].id+")");if(d[c].name==gettext("member-general-name")){$("#member_menuitem_delete_"+d[c].id).hide();$("#member_menuitem_rename_"+d[c].id).hide()}e+=d[c].email_count}if(e==0){$("#member_button_all").attr("disabled","disabled")}else{$("#member_button_all").removeAttr("disabled")}if(a==0){participant_load(d[0].id,b)}else{$.when(participant_load(a,b)).done(bulk_load_callbacks.fire())}},error:function(d,e,c){console.log(d.status+": "+d.responseText)}})}function member_load_elements(a){$(".list_members_to_copy").empty();$("#list_members_to_move").empty();$.ajax({url:"/api/members/",type:"GET",success:function(c){for(var b=0;b<c.length;b++){if(c[b].id!=a){$(".list_members_to_copy").append("<li><label><input type='checkbox' id='m"+c[b].id+"' class='checkbox_member' value='"+c[b].id+"'>"+c[b].name+"</label></li>");$("#list_members_to_move").append("<option id='m"+c[b].id+"' value='"+c[b].id+"'>"+c[b].name+"</option>")}}$(".list_members_to_copy").find("input[class='checkbox_member']").iCheck({tap:true,checkboxClass:"icheckbox_minimal-grey"})},error:function(c,d,b){console.log(c.status+": "+c.responseText)}})}function member_add(){var c=$("#member_add_form");var d=$("#member_add_name",c);var a=$(".errorHandler",c);var b=$(".messageHandler",c);member_name=d.val();b.html("<ul class='fa-ul'><li><i class='fa fa-spinner fa-li fa-spin'></i>&nbsp;"+gettext("member-add-loading")+"</li></ul>");$.ajax({url:"/api/members/",type:"POST",data:{name:member_name},success:function(e){b.html("<ul class='fa-ul'><li><i class='fa fa-info-cicle fa-li fa-lg'></i>"+gettext("member-add-complete")+"</li></ul>");member_load(0)},error:function(g,h,f){b.hide();a.show();var e=JSON.parse(g.responseText);a.html("<i class='fa fa-exclamation-circle fa-lg'></i> "+gettext(e.name));console.log(g.status+": "+g.responseText);d.select()}})}function member_add_cancel(){var c=$("#member_add_form");var a=$(".errorHandler",c);var b=$(".messageHandler",c);$("#button_add_member").removeClass();$("#button_add_member").toggleClass("btn btn-primary");$("#button_add_member").attr("onclick","member_add_show()");$("#member_add_tool").hide("slow");$("#member_add_name").val("");a.hide();b.hide();c.find(".help-block").remove();c.find(".form-group").removeClass("has-error")}function member_add_show(){var b=$("#member_add_form");var c=$("#member_add_name",b);var a=$(".messageHandler",b);$("#button_add_member").removeClass();$("#button_add_member").toggleClass("btn btn-light-grey");$("#button_add_member").removeAttr("onclick",null);$("#member_add_tool").show("slow");c.empty();a.html("<ul class='fa-ul'><li><i class='fa fa-info-circle fa-li fa-lg'></i>"+gettext("member-add-instructions")+"</li></ul>");a.show();c.focus()}function member_modal_bulk_load(){var f=$("#member_modal_bulk_load_form");var d=$("#member_modal_bulk_load_select",f).val();var b=$("input[name=optionsRadios]:checked",f).val();var a=$("#member_modal_bulk_load_textarea",f).val();var h=$("#member_modal_bulk_load_overwrite",f).is(":checked");var c=$("input[type=file]",f).get(0).files[0];var e=$(".member_modal_bulk_load_form_message",f);var g=new FormData();g.append("option",b);g.append("overwrite",h);if(b=="text"){g.append("participants_text",a)}else{g.append("participants_file",c)}$.ajax({url:"/api/members/"+d+"/participants/",type:"PUT",data:g,dataType:"json",enctype:"multipart/form-data",cache:false,multiple:false,processData:false,contentType:false,success:function(j){$("#member_modal_bulk_load_cancel").click();var i=function(){var l=j.resume;var k="<a href='/participants/member-bulk-load-resume'>"+gettext("member-bulk-load-resume-download")+"</a>";$("#member_bulk_load_resume").html("<pre>"+l+"</pre>"+k);bulk_load_callbacks.empty()};bulk_load_callbacks.add(i);member_load(d)},error:function(k,l,j){var i=JSON.parse(k.responseText);e.html("<div class='col-sm-7 text-danger' style='text-align:left'><i class='fa fa-exclamation-circle fa-lg'></i> "+gettext(i.name)+"</div>");console.log(k.status+": "+k.responseText)}})}function member_modal_bulk_load_cancel(){var c=$("#member_modal_bulk_load_form");var a=$(".member_modal_bulk_load_form_error",c);var b=$(".member_modal_bulk_load_form_message",c);b.hide();a.hide();c.find(".help-block").remove();c.find(".form-group").removeClass("has-error")}function member_modal_bulk_load_config(a){$("#member_modal_bulk_load_radio").iCheck("check");$("#member_modal_bulk_load_text").hide();$("#member_modal_bulk_load_file").show();$(".fileinput-remove-button").click();$("#member_modal_bulk_load_textarea").val("");$("#member_modal_bulk_load_overwrite").iCheck("uncheck");$("#member_modal_bulk_load_form_message").empty();member_modal_bulk_load_select(a);$("#member_modal_bulk_load_form input[name=optionsRadios]").on("ifClicked",function(b){if($(this).val()=="file"){$("#member_modal_bulk_load_text").hide();$("#member_modal_bulk_load_file").show()}else{$("#member_modal_bulk_load_file").hide();$("#member_modal_bulk_load_text").show()}});$("#member_modal_bulk_load_select").change(function(){var b=$("#member_modal_bulk_load_select").val();if(b==0){$("#member_modal_new").modal("show");$("#member_modal_new_name").val("")}else{member_modal_bulk_load_toggle_checkbox(b)}})}function member_modal_bulk_load_select(a){$("#member_modal_bulk_load_select").empty();$.ajax({url:"/api/members/",type:"GET",success:function(c){for(var b=0;b<c.length;b++){$("#member_modal_bulk_load_select").append("<option value='"+c[b].id+"'>"+c[b].name+"</option>");member_map[c[b].id]=c[b].email_count}$("#member_modal_bulk_load_select").append("<option value=0>"+gettext("member-modal-bulk-load-select-add-new")+"</option>");$("#member_modal_bulk_load_select").val(a);member_modal_bulk_load_toggle_checkbox(a)},error:function(c,d,b){console.log(c.status+": "+c.responseText)}})}var member_map={};function member_modal_bulk_load_toggle_checkbox(a){$("#member_modal_bulk_load_overwrite").iCheck("uncheck");if(member_map[a]==0){$("#member_modal_bulk_load_checkbox").hide("slow")}else{$("#member_modal_bulk_load_checkbox").show("slow")}}function member_modal_delete(a){$.ajax({url:"/api/members/"+a,type:"DELETE",success:function(b){$("#member_modal_delete_close").click();member_load(0);toastr.info(gettext("member-modal-delete-confirm"))},error:function(c,d,b){console.log(c.status+": "+c.responseText)}})}function member_modal_delete_config(a,b){$("#member_modal_delete_submit").attr("onclick","member_modal_delete("+b+")");$("#member_modal_delete_label").html(a)}function member_modal_duplicate(c){var e=$("#member_modal_duplicate_form");var f=$("#member_modal_duplicate_name",e);var d=$(".member_modal_duplicate_form_message",e);var b=$("#member_modal_duplicate_cancel",e);var a=f.val();$.ajax({url:"/api/members/"+c,type:"POST",data:{name:a},success:function(g){b.click();member_load(g.id)},error:function(i,j,h){var g=JSON.parse(i.responseText);d.html("<div class='col-sm-7 text-danger' style='text-align:left'><i class='fa fa-exclamation-circle fa-lg'></i> "+gettext(g.name)+"</div>");console.log(i.status+": "+i.responseText)}})}function member_modal_duplicate_cancel(){var c=$("#member_modal_duplicate_form");var a=$(".member_modal_duplicate_form_error",c);var b=$(".member_modal_duplicate_form_message",c);b.hide();a.hide();c.find(".help-block").remove();c.find(".form-group").removeClass("has-error")}function member_modal_duplicate_config(a,b){$("#member_modal_duplicate_form_message").empty();$("#member_modal_duplicate_name").val(gettext("member-modal-duplicate-name-copy")+a);$("#member_modal_duplicate_submit").attr("value",b);$("#member_modal_duplicate").on("shown.bs.modal",function(){$("#member_modal_duplicate_name").select()})}function member_modal_bulk_load_add_cancel(){var c=$("#member_modal_new_form");var a=$(".member_modal_new_form_error",c);var b=$(".member_modal_new_form_message",c);b.hide();a.hide();c.find(".help-block").remove();c.find(".form-group").removeClass("has-error")}function member_modal_bulk_load_add(){var d=$("#member_modal_new_form");var e=$("#member_modal_new_name",d);var c=$(".member_modal_new_form_message",d);var b=$("#member_modal_new_cancel",d);var a=e.val();$.ajax({url:"/api/members/",type:"POST",data:{name:a},success:function(f){b.click();member_modal_bulk_load_select(f.id)},error:function(h,i,g){var f=JSON.parse(h.responseText);c.html("<div class='col-sm-7 text-danger' style='text-align:left'><i class='fa fa-exclamation-circle fa-lg'></i> "+gettext(f.name)+"</div>");e.select();console.log(h.status+": "+h.responseText)}})}function member_modal_rename(d){var f=$("#member_modal_rename_form");var g=$("#member_modal_rename_name",f);var c=$(".member_modal_rename_form_error",f);var e=$(".member_modal_rename_form_message",f);var b=$("#member_modal_rename_cancel",f);var a=g.val();$.ajax({url:"/api/members/"+d,type:"PUT",data:{name:a},success:function(h){b.click();member_load(d)},error:function(j,k,i){e.hide();c.show();var h=JSON.parse(j.responseText);c.html("<div class='col-sm-7 text-danger' style='text-align:left'><i class='fa fa-exclamation-circle fa-lg'></i> "+gettext(h.name)+"</div>");g.select();console.log(j.status+": "+j.responseText)}})}function member_modal_rename_cancel(){var c=$("#member_modal_rename_form");var a=$(".member_modal_rename_form_error",c);var b=$(".member_modal_rename_form_message",c);b.hide();a.hide();c.find(".help-block").remove();c.find(".form-group").removeClass("has-error")}function member_modal_rename_config(a,b){$(".member_modal_rename_form_message").empty();$("#member_modal_rename_name").val(a);$("#member_modal_rename_submit").attr("value",b);$("#member_modal_rename").on("shown.bs.modal",function(){$("#member_modal_rename_name").select()})};